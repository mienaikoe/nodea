hide id='loadies'
    hide class='loadie' id='samples'
    hide class='loadie' id='ditties'


div id='studio' class='left right bottom top'
  
    div id='machine' class='center'
        div id='ideas'
            =render partial: 'ideas', locals: {}
        div id='circuit'  class='bottom charm'
            =render partial: 'circuit', locals: {}


    div id='sample_drawer' class='drawer right top bottom charm'
    div id='ditty_drawer' class='drawer left top bottom charm'

/
  div id='controls'
    spiv id='controls_center'
      -['beginning','rewind','stop','record','play','forward','end'].each do |control|
        spiv class='control' id="control_#{control}"


  
javascript:
    var bindings = #{raw @samples.map{|s|s ? s.file.url : nil}.to_json};
    var timings = [ // open song 
        { key: '1',     start: 0,      end: 24},
        { key: '2',     start: 32,     end: 48},
        { key: '1',     start: 48,     end: 95},
        { key: '3',     start: 72,     end: 95},
        { key: '1',     start: 96,    end: 143},
        { key: '3',     start: 96,    end: 108},
        { key: '1',     start: 288,    end: 480},
        { key: '2',     start: 144,    end: 480},
    ];
    var beat = 4;
    var bpm = 144;

    var project, ideas, circuit;
    $(function() {
        project = new Project(bindings, timings, beat, bpm);
        circuit = new Circuit(project);
        ideas = new Ideas(project, circuit);
        


        // should be able to enter music as a typewriter
        // enter key should skip to next increment a configurable number of times 
        // (smallest chunk is 132)
        $("body").keydown(function(ev) {
            var ascii = ev.which
            if(ascii === 32){
                if( ideas.startTime == null ){ ideas.start(); } 
                else { ideas.pause(); }
            } else if (ascii === 59) {
                ascii = 186;
            } else if (ascii < 48) {
                ascii = ascii + 144;
            } else if( ev.which > 200) { //perhaps this should be handled by dummy nodas
                return;
            } 
            circuit.nodas[ascii].on();
            ev.preventDefault();
        }).keyup(function(ev) {
            var ascii = ev.which
            if(ascii === 13){
                ideas.start();
            } else if (ascii === 59) {
                ascii = 186;
            } else if (ascii < 48) {
                ascii = ascii + 144;
            } else if( ev.which > 200) { //perhaps this should be handled by dummy nodas
                return;
            } 
            circuit.nodas[ev.which].off();
        });
    });
